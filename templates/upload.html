<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Macquarie Electric ‚Äì Upload</title>
    <style>
      body {
        font-family: Inter, system-ui;
        margin: 2rem;
        background: #f4f7fa;
        color: #222;
      }
      .card {
        background: #fff;
        padding: 2rem;
        max-width: 480px;
        margin: auto;
        border-radius: 10px;
        box-shadow: 0 4px 18px rgba(0, 0, 0, 0.08);
      }
      .msg {
        margin: 0.5rem 0;
        padding: 0.6rem 1rem;
        border-radius: 6px;
        font-size: 0.9rem;
      }
      .info {
        background: #e7f3ff;
        color: #005a9c;
      }
      .success {
        background: #e6f7ee;
        color: #0f9d58;
      }
      .error {
        background: #fce8e6;
        color: #d93025;
      }
      #spinner {
        display: none;
        margin: 0.5rem 0;
      }
      .fa-spinner {
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="card">
      <h1>Upload Excel</h1>

      <div id="messages"></div>
      <div id="spinner"><i class="fa-solid fa-spinner"></i> Processing‚Ä¶</div>

      <form id="upload-form" enctype="multipart/form-data">
        <input type="file" name="excel_file" accept=".xlsx,.xls" required />
        <button type="submit">Upload & Process</button>
      </form>
    </div>

    <script>
      const form = document.getElementById("upload-form");
      const msgBox = document.getElementById("messages");
      const spin = document.getElementById("spinner");

      function addMsg(text, cls = "info") {
        const div = document.createElement("div");
        div.className = "msg " + cls;
        div.textContent = text;
        msgBox.appendChild(div);
        div.scrollIntoView({ behavior: "smooth" });
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        msgBox.innerHTML = "";
        spin.style.display = "block";

        const data = new FormData(form);
        const res = await fetch("/", { method: "POST", body: data });

        if (res.ok) {
          const blob = await res.blob();
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "processed.xlsx";
          a.click();
          URL.revokeObjectURL(url);
          addMsg("üéâ File processed & download started!", "success");
        } else {
          const txt = await res.text();
          addMsg("‚ùå " + txt, "error");
        }
        spin.style.display = "none";
      });
    </script>
  </body>
</html>
